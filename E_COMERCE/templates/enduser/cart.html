{% extends "enduser/base.html" %}
{% load static %}
{% block title %}Cart | Show_me{% endblock %}
{% block extra_js %}
  <script src="{% static 'js/cart.js' %}"></script>
{% endblock %}

{% block content %}
<div class="container" style="height: 100%;">
  <h2 class="mb-4 text-center"><i class="bi bi-cart-fill me-2"></i>Your Cart</h2>
  <div class="row">
    <!-- Left: Cart Items -->
    <div class="col-md-8"style="padding:0px!important;">
      <div class="mb-3 p-3 border rounded bg-white">
        <h5 class="mb-3">From Saved Addresses</h5>
        {% if cart_items %}
        {% for item in cart_items %}
        <div id="cart-item-{{ item.id }}" class="d-flex border-bottom py-3 align-items-center justify-content-between">

          <!-- Product Info -->
          <div class="d-flex align-items-center">
            <div class="me-3" style="height:80px; width:80px;">
              <img src="{{ item.product_item.photo_url }}" alt="{{ item.product_item.name }}"
                style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <div>
              <h6 class="mb-1" onclick="window.location.href='{% url 'product_details' item.product_item.id %}'"
                style="cursor: pointer;">
                {{ item.product_item.product.name }}
              </h6>
              
              <p class="mb-1">Size: {{ item.display_size }}</p>
              <p class="mb-1">Color: {{ item.display_color }}</p>
               {% if item.availibility <= 5 %}
                  <div class="text-danger small mt-1 text-center fw-semibold">Harry!({{item.availibility}} stocks available)</div>
                {% endif %}
            </div>
          </div>

          <!-- Remove Button (Cross Icon) -->
          <button class="btn btn-link text-danger fs-4 p-0" onclick="removeCartItem({{ item.id }})" title="Remove Item">
            &times;
          </button>
        </div>
        {% endfor %}


        {% else %}
        <p class="alert alert-info mt-4">No Cart items available
        <p>
          {% endif %}
      </div>
    </div>

    <!-- Right: Price Summary -->
    <div class="col-md-4" style="padding:0px!important;">
      <div class="border rounded bg-white p-3">
        <h6 class="fw-bold mb-3 text-muted">PRICE DETAILS</h6>
        <div class="d-flex justify-content-between mb-2">
          <span>Price ({{ total_items }} item{% if total_items > 1 %}s{% endif %})</span>
          <span>₹{{ price|floatformat:2 }}</span>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Discount</span>
          <span class="text-success">− ₹{{ discount }}</span>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Platform Fee</span>
          <span>₹{{ platform_fee }}</span>
        </div>
        <hr>
        <div class="d-flex justify-content-between mb-2 fw-bold">
          <span>Total Amount</span>
          <span>₹{{ total }}</span>
        </div>
        <p class="text-success mt-2">You will save ₹{{ discount }} on this order</p>
      </div>

      <div class="mt-3">
        <button class="btn btn-warning w-100 fw-bold" onclick="window.location.href='/order/create/'">PLACE
          ORDER</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}