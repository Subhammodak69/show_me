{% extends "enduser/base.html" %}
{% load static %}
{% block title %}Home | Show_me{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/products.css' %}">
{% endblock %}
{% block extra_js %}
  <script src="{% static 'js/home.js' %}"></script>
{% endblock %}
{% block content %}
<div class="home-container" style="gap: 20px;display: flex;">
  <section class="d-flex flex-column" style="width: 100%; overflow-y: auto; gap:10px;">
    
    {% if product_items %}
    <!-- ADD ID HERE üëá -->
    <div id="product-grid" class="d-flex flex-wrap justify-content-center overflow-auto pb-3" 
         style="min-height: 280px;">
      {% for product in product_items %}
        <div class="card pro-cards p-2 text-center position-relative flex-shrink-0" 
             style="min-width:170px;max-width:180px;height:300px;margin: 15px;">
          <!-- Your existing product card HTML stays EXACTLY the same -->
          <i id="wishlist-icon-{{ product.id }}" 
             class="bi bi-heart position-absolute top-0 end-0 m-2 p-1 wishlist-icon"
             style="font-size: 18px; z-index: 10; cursor: pointer;"
             onclick="toggle_wishlist_create_update({{ product.id }})"
             title="Add to wishlist"></i>
          <div class="d-flex align-items-center justify-content-center" style="height: 150px;">
            <img src="{{ product.photo_url }}" alt="{{ product.title }}" class="card-img-top mx-auto"
                style="height:100%;object-fit:contain;">
          </div>
          
          <div class="card-body px-0">
            <div class="text-muted" style="font-size:14px;">‚≠ê{{ product.rating }} | ({{product.rating_count}})</div>
            <div class="card-title" 
                 style="
                   display: -webkit-box;
                   -webkit-line-clamp: 3;
                   -webkit-box-orient: vertical;
                   overflow: hidden;
                   text-overflow: ellipsis;
                   max-height: 60px;
                   font-size:15px; 
                   color: blue; 
                   cursor:pointer;
                   line-height: 1.3em;
                 "
                 onclick="window.location.href='{% url 'product_details' product.id %}'">
              {{ product.product_name }}
            </div>
            {% if product.price_data.sale_price == product.price_data.original_price %}
              <div class="card-text text-muted" style="font-size:14px;">‚Çπ{{ product.price_data.original_price }}</div>
            {% else %}
            <span style="text-decoration: line-through;font-size:14px; color: #dc3545;">‚Çπ{{ product.price_data.original_price }}</span>  
            <span style="font-size:14px;">‚Çπ{{ product.price_data.sale_price }}</span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>  <!-- üëà product-grid ends here -->

   {% if initial_data.has_next %}
    <div id="infinite-scroll-trigger" 
        hx-get="{% url 'category_products_ajax' category_id %}?page={{ initial_data.next_page }}"
        hx-target="#product-grid" 
        hx-swap="beforeend"
        hx-trigger="revealed"
        hx-indicator="#loading"
        style="height: 20px;"></div>
    <div id="loading" class="text-center py-4" style="display: none;">
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      Loading more products...
    </div>
    {% endif %}


    {% else %}
    <p class="text-center muted">Product items not available yet.</p>
    {% endif %}
  </section>
</div>
{% endblock %}