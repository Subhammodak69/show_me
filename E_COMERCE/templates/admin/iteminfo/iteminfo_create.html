{% extends 'admin/home.html' %}
{% load static %}

{% block title %}Create Item Info{% endblock %}

{% block content %}
<div class="mb-3 text-center">
  <h2 class="mb-4">Create Item Info</h2>
</div>

<div class="container" style="padding: 40px; max-width: 600px; background: whitesmoke; border-radius: 10px;">
  <form id="iteminfo-create-form" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Product Item -->
    <div class="mb-3">
      <label class="form-label fw-bold">Product Item <span class="text-danger">*</span></label>
      <select name="product_item" class="form-select" required>
        <option value="" disabled selected>Select Product Item...</option>
        {% for item in productitems %}
        <option value="{{ item.id }}">#{{ item.id }}({{item.product_item.product.name}} {{item.product_item.brand_name}})</option>
        {% endfor %}
      </select>
    </div>

    <!-- Size -->
    <div class="mb-3">
      <label class="form-label fw-bold">Size <span class="text-danger">*</span></label>
      <select name="size" class="form-select" required>
        <option value="" disabled selected>Select Size...</option>
        {% for size in sizes %}
        <option value="{{ size.value }}">{{ size.name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Color -->
    <div class="mb-3">
      <label class="form-label fw-bold">Color <span class="text-danger">*</span></label>
      <select name="color" class="form-select" required>
        <option value="" disabled selected>Select Color...</option>
        {% for color in colours %}
        <option value="{{color.value }}">{{ color.name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Photo Upload -->
    <div class="mb-3">
      <label class="form-label fw-bold">Product Photo <span class="text-danger">*</span></label>
      <input type="file" name="photo" class="form-control" accept="image/*" required>
      <div class="form-text">Max size: 5MB. Formats: JPG, PNG, WebP</div>
    </div>

    <!-- Stock -->
    <div class="mb-3">
      <label class="form-label fw-bold">Stock Quantity</label>
      <input type="number" name="stock" class="form-control" min="0" value="0">
    </div>

    <!-- Buttons -->
    <div class="d-flex gap-2 justify-content-between">
      <button type="submit" class="btn btn-success flex-fill">
        <i class="fas fa-save me-2"></i>Create
      </button>
      <a href="{% url 'iteminfo_list' %}" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<!-- Loading Overlay -->
<div class="loading position-fixed d-none justify-content-center align-items-center" 
     style="top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999;">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<script>
document.getElementById('iteminfo-create-form').addEventListener('submit', function(e) {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);
  const loader = document.querySelector('.loading');
    if (loader) {
        loader.style.display = 'flex';
    }

  fetch("{{ request.path }}", {
    method: "POST",
    headers: {
      "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').getAttribute('value')
    },
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    loader.style.display = 'none';
    if (data.success) {
      window.location.href = "{% url 'iteminfo_list' %}";
    } else {
        loader.style.display = 'none';
      alert("Error: " + (data.error || 'Creation failed'));
    }
  })
  .catch(error => {
    loader.style.display = 'none';
    alert("Server error occurred.");
  });
});
</script>

{% endblock %}
