{% extends 'admin/home.html'%}
{% load static %}
{% block title %}Category Create | Show_me {% endblock %}
{% block content %}

<div class="mb-3 text-center">
  <h2 class="mb-4">Category Create</h2>
</div>
<div class="container" style="padding: 40px;max-width: 600px;background: whitesmoke;border-radius: 10px;">
<form id="createCategoryForm">
  {% csrf_token %}
  <div class="mb-3">
    <label for="name" class="form-label">Category Name</label>
    <input type="text" class="form-control" id="name" name="name" required>
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">Description</label>
    <textarea class="form-control" id="description" name="description" required></textarea>
  </div>
  <div class="mb-3">
    <!-- Image File Input -->
    <label for="photo">Upload Photo</label>
    <input class="form-control mb-2" type="file" id="photo" accept="image/*" required />

    <!-- Optional: Image preview -->
    <img id="preview" class="my-3" style="max-height: 150px; display:none;" />
  </div>

  <button type="submit" class="btn btn-primary">Create</button>
</form>
</div>


<script>
document.getElementById("photo").addEventListener("change", function() {
  const file = this.files[0];
  const preview = document.getElementById("preview");

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
});

document.getElementById('createCategoryForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // Show loader
    const loader = document.querySelector('.loading');
    if (loader) {
        loader.style.display = 'flex';
    }

    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    // Create FormData object for sending multipart/form-data
    const formData = new FormData();
    formData.append('name', document.getElementById('name').value);
    formData.append('description', document.getElementById('description').value);
    
    // Append the selected image file
    const photoInput = document.getElementById('photo');
    if(photoInput.files.length > 0) {
        formData.append('photo', photoInput.files[0]);
    }

    const response = await fetch("{% url 'category_create' %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': csrfToken  // Fixed: use variable instead of string
        },
        body: formData
    });

    const result = await response.json();
    
    // Hide loader
    if (loader) {
        loader.style.display = 'none';
    }

    // Redirect after success
    window.location.href = "{% url 'category' %}";
});


</script>

{% endblock %}
